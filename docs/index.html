<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Top 1000 Words in Gilaki</title>
  <link rel="shortcut icon" type="image/png" href="favicon.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vazir-font/27.2.2/font-face.min.css" />
  <meta name=theme-color content="#00afff">
  <style>
    :root {
      --main-color: #00afff;
      --border-radius: 8px;
      --border-color: #ddd;
    }

    body {
      margin: 0;
      padding: 0;
      text-align: center;
      font-family: "Vazir", Arial, sans-serif;
      border-top: solid 3px var(--main-color);
    }

    #app {
      opacity: .1;
      transition: opacity .5s;
    }

    body.is-mounted #app {
      opacity: 1;
    }

    .container {
      max-width: 960px;
      margin: auto;
      padding: 0 16px;
    }

    a {
      text-decoration: none;
      color: black;
    }

    h1 {
      padding-left: 16px;
      padding-right: 16px;
      font-size: 1.6rem;
    }

    .repo-link {
      font-size: .9rem;
      padding: 0 16px;
      color: grey;
    }
    .repo-link a {
      display: inline-block;
      cursor: pointer;
      padding: 0 16px;
      color: #1064d9;
    }

    .lang-switch span {
      cursor: pointer;
      font-size: .8rem;
    }

    .list {
      border: solid 1px var(--border-color);
      width: 100%;
      box-sizing: border-box;
      overflow: visible;
      border-radius: var(--border-radius);
    }

    .list-item {
      border-bottom: solid 1px var(--border-color);
      height: 52px;
      overflow: hidden;
      display: flex;
      align-items: center;
    }

    .list-item:last-child {
      border-bottom: none;
    }

    .list-item.head {
      background-color: #f2f2f2;
      font-weight: bold;
      user-select: none;
      border-radius: 2px 2px 0 0;
      border-radius: var(--border-radius) var(--border-radius) 0 0;
    }

    .list-item.head .col {
      line-height: 2.5rem;
    }

    .list-item .col {
      text-align: right;
      display: inline-block;
      box-sizing: border-box;
      vertical-align: top;
      padding: 8px 16px;
      font-size: 0.9rem;
      line-height: 1.4;
      max-height: 52px;
    }

    .list .col-no {
      width: 4%;
    }

    .list .col-word {
      width: 16%;
    }

    .list .col-example {
      width: 34%;
      text-align: center;
    }

    .list .col-word-head {
      width: 16%;
      text-align: center;
    }

    .list .col-example-head {
      width: 34%;
      text-align: center;
    }

    .input-wrapper {
      width: 100%;
      padding: 16px;
      box-sizing: border-box;
      border: solid 1px var(--border-color);
      outline: none;
      border-radius: 50px;
      max-width: 500px;
      margin: 20px auto;
      height: 50px;
      transition: border-color 0.1s, box-shadow 0.1s;
    }

    .text-field {
      line-height: 25px;
      background-color: transparent;
      border: none;
      margin: 0;
      padding: 0 0 0 16px;
      font-size: 1rem;
      color: rgba(0,0,0,.87);
      word-wrap: break-word;
      outline: none;
      display: flex;
      flex: 1;
      -webkit-tap-highlight-color: transparent;
      width: 100%;
      font-family: Vazir, Arial, sans-serif;

      height: 39px !important;
      line-height: 1;
      margin-top: -12px;
    }
    .input-wrapper:focus-within {
      box-shadow: 0 1px 6px rgb(32 33 36 / 28%);
      border-color: rgba(223,225,229,0);
    }

    .not-found-message {
      padding: 50px;
      box-sizing: border-box;
    }

    .not-found-message span {
      background-color: #eee;
      display: inline-block;
      padding: 0 16px;
      border-radius: var(--border-radius);
    }

    .btn {
      display: inline-block;
      padding: 8px;
      font-weight: bold;
      cursor: pointer;
    }

    .fab {
      background-color: var(--main-color);
      border-radius: 50%;
      box-shadow:
        0px 3px 5px -1px rgb(0 0 0 / 20%),
        0px 6px 10px 0px rgb(0 0 0 / 14%),
        0px 1px 18px 0px rgb(0 0 0 / 12%);
      display: inline-flex;
      position: fixed;
      bottom: 16px;
      left: 16px;
      align-items: center;
      justify-content: center;
      box-sizing: border-box;
      width: 56px;
      height: 56px;
      padding: 0;
      border: none;
      fill: currentColor;
      cursor: pointer;
      user-select: none;
      overflow: hidden;
      transition:
        box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1),
        opacity 15ms linear 30ms,
        transform 270ms 0ms cubic-bezier(0, 0, 0.2, 1);
      color: #fff;
    }

    .fab svg {
      fill: #fff;
    }

    .footer {
      color: #999;
    }

    .loading {
      direction: ltr;
    }

    .loading-failed {
      direction: ltr;
    }

    @media screen and (max-width: 600px) {
      .list-item.head {
        display: none;
      }

      .list-item {
        border-bottom: 3px solid var(--border-color);
        display: block;
        height: auto;
        margin-bottom: .625em;
      }

      .list-item .col {
        border-bottom: 1px solid var(--border-color);
        display: block;
        font-size: 12px;
        padding: 2px 8px;
        text-align: right;
        width: auto !important;
      }

      .list-item .col::before {
        /*
        * aria-label has no advantage, it won't be read inside a table
        content: attr(aria-label);
        */
        content: attr(data-label);
        float: left;
        font-weight: normal;
        color: #555;
        font-size: 11px;
        text-transform: uppercase;
      }

      .list-item .col:last-child {
        border-bottom: 0;
      }
    }

    .fade-list-move {
      transition: transform 0.25s ease;
    }

    .fade-list-leave-to {
      transition: all 0.3s ease;
      opacity: 0;
    }
  </style>
</head>

<body>
  <div id="app">
    <div class="container">
      <h1><a href="index.html" v-text="t('title')">هزار کلمه پرکاربرد در گیلکی</a></h1>
      <div class="repo-link">
        <a href="https://github.com/LordArma/Top-1000-Words-in-Gilaki" v-text="t('githubRepository')"></a>
        <span> | </span>
        <a @click="switchLang" v-text="t('langSwitchText')"></a>
      </div>
      <div class="input-wrapper">
        <input
          ref="searchInput"
          :value="query"
          dir="auto"
          :placeholder="t('search')"
          :style="{textAlign: lang === 'fa' ? 'right' : 'left'}"
          class="text-field"
          @input="onInput"
        />
      </div>
      <div v-if="loaded" class="list">
        <div class="list-item head">
          <div class="col col-word-head"><span v-text="t('gilakiWord')"></span></div>
          <div class="col col-example-head"><span v-text="t('gilakiExample')"></span></div>
          <div class="col col-word-head"><span v-text="t('translatedWord')"></span></div>
          <div class="col col-example-head"><span v-text="t('translatedExample')"></span></div>
        </div>
        <div v-for="record in items" :key="record.id" class="list-item">
          <div class="col col-word" :data-label="t('gilakiWord')">
            <a :href="record.gilakiUrl" target="_blank" v-text="record.gilakiWord"></a>
          </div>
          <div class="col col-example" :data-label="t('gilakiExample')">
            <span v-text="record.gilakiExample"></span>
          </div>
          <div class="col col-word" dir="auto" :data-label="t('translatedWord')">
            <a :href="record.translatedUrl" target="_blank" v-text="record.translatedWord"></a>
          </div>
          <div class="col col-example" dir="auto" :data-label="t('translatedExample')">
            <span v-text="record.translatedExample"></span>
          </div>
        </div>
        <div v-if="collapsed && items.length === visibleItemsLimit" @click="showAll" class="btn">
          <span v-text="t('showAll')"></span>
        </div>
        <div v-if="items.length === 0" class="not-found-message">
          <span v-text="t('wordNotFound')"></span>
        </div>
      </div>
      <div v-else-if="loading" class="loading">
        <span v-text="t('loading')"></span>
      </div>
      <div v-else-if="failed" @click="loadData" class="loading-failed">
        <span v-text="t('errorTryAgain')"></span>
      </div>
      <div class="footer">
        <p>&nbsp;</p>
      </div>
      <button @click="switchLang" class="fab">
        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#000000"><path d="M0 0h24v24H0z" fill="none"/><path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>
      </button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12"></script>
  <script>
    var dataSource = './Top 1000 Words in Gilaki.min.json';
    var words = [];
    var wordsMapRaw = [];
    var wordsMap = [];
    var searchKeys = [
      'gilakiWord',
      'gilakiExample',
      'translatedWord',
      'translatedExample',
    ]
    var translations = {
      fa: {
        'title': 'هزار کلمه پرکاربرد در گیلکی',
        'gilakiWord': 'کلمه گیلکی',
        'gilakiExample': 'مثال گیلکی',
        'translatedWord': 'کلمه فارسی',
        'translatedExample': 'مثال فارسی',
        'githubRepository': 'مخزن گیت‌هاب',
        'showAll': 'نمایش همه',
        'loading': 'بارگذاری...',
        'wordNotFound': 'کلمه پیدا نشد',
        'errorTryAgain': 'خطا! مجددا تلاش کنید',
        'langSwitchText': 'English',
        'search': 'جستجو',
      },
      en: {
        'title': 'Top 1000 Words in Gilaki',
        'gilakiWord': 'Gilaki Word',
        'gilakiExample': 'Gilaki Example',
        'translatedWord': 'English Word',
        'translatedExample': 'English Example',
        'githubRepository': 'Github Repository',
        'showAll': 'Show All',
        'loading': 'Loading...',
        'wordNotFound': 'Word not found',
        'errorTryAgain': 'Error! try again',
        'langSwitchText': 'فارسی',
        'search': 'Search',
      }
    };
    function updateWordsMap (items, lang) {
      var twKey = lang === 'en' ? 'en_word' : 'fa_word';
      var teKey = lang === 'en' ? 'en_example' : 'fa_example';
      var wikiPrefix = lang === 'en' ? 'https://en.wikipedia.com/wiki/' : 'https://fa.wikipedia.com/wiki/';
      wordsMap = [];
      for(var i = 0; i < items.length; i++) {
        var item = items[i];
        wordsMap.push({
          id: i,
          gilakiWord: item['glk_word'],
          gilakiExample: item['glk_example'],
          gilakiUrl: 'https://glk.wikipedia.org/wiki/' + item['glk_word'],
          translatedWord: item[twKey],
          translatedExample: item[teKey],
          translatedUrl: wikiPrefix + item[twKey]
        });
      }
      wordsMap = wordsMap.map(Object.freeze);
    }
    window.onload = function onload() {
      new Vue({
        el: '#app',
        data: {
          loading: true,
          loaded: false,
          failed: false,
          collapsed: true,
          lang: null,
          visibleItemsLimit: 50,
          query: '',
          items: []
        },
        methods: {
          t: function (v) {
            return translations[this.lang][v];
          },
          updatePageTitle: function () {
            document.title = this.t('title');
          },
          switchLang: function () {
            this.lang = this.lang === 'fa' ? 'en' : 'fa';
            this.updatePageTitle();
            if (this.loaded) {
              updateWordsMap(words, this.lang);
              this.applyFiltering(true);
            }
          },
          onInput: function (e) {
            this.query = e.target.value;
            this.applyFiltering();
          },
          applyFiltering: function (noReset) {
            const q = this.query.toLowerCase();
            if (q.length === 0) {
              if (this.collapsed || !noReset) {
                this.items = wordsMap.slice(0, this.visibleItemsLimit);
                this.collapsed = true
              } else {
                this.items = wordsMap;
              }
            } else {
              var res = [];
              var cc = 0;
              this.collapsed = false;
              for (var i = 0; i < wordsMap.length; i++) {
                var o = wordsMap[i];
                for (var ii = 0; ii < searchKeys.length; ii++) {
                  var key = searchKeys[ii];
                  if (o[key].toLowerCase().substring(0, q.length) === q) {
                    res.push(o);
                    cc++;
                    break;
                  }
                }
                if (cc === this.visibleItemsLimit) {
                  break;
                }
              };
              this.items = res;
            }
          },
          loadData: function (cb) {
            vm = this;
            vm.loading = true;
            vm.failed = false;
            vm.loaded = false;
            var request = new XMLHttpRequest();
            request.open('GET', dataSource, true);
            request.onload = function () {
              if (this.status >= 200 && this.status < 400) {
                words = JSON.parse(this.response);
                words = words.sort(function (a, b) {
                  return a.glk_word < b.glk_word;
                })
                updateWordsMap(words, this.lang);
                vm.applyFiltering();
                vm.loaded = true;
                vm.loading = false;
              } else {
                vm.failed = true;
                vm.loading = false;
              }
            };
            request.onerror = function () {
              vm.failed = true;
              vm.loading = false;
            };
            request.send();
          },
          showAll: function () {
            this.items = wordsMap;
            this.collapsed = false;
          }
        },
        beforeMount: function () {
          this.switchLang('fa');
        },
        mounted: function () {
          this.loadData();
          setTimeout(function () {
            document.body.classList.add('is-mounted');
            document.body.querySelector('input').focus();
          }, 0);
        }
      })
    }
  </script>
</body>

</html>
